<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GluckCalc</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#e8ecf1">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cdefs%3E%3ClinearGradient id='g' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' stop-color='%235b7bf2'/%3E%3Cstop offset='100%25' stop-color='%234a6ae0'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='100' height='100' rx='20' fill='url(%23g)'/%3E%3Cpath d='M30 65 L50 75 L70 65 L70 40 L50 30 L30 40 Z' fill='none' stroke='white' stroke-width='4' stroke-linejoin='round'/%3E%3Cpath d='M50 30 L50 55 M30 40 L50 55 L70 40' fill='none' stroke='white' stroke-width='4' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E">
</head>
<body>
    <div class="app-container">
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-resize-handle" id="sidebar-resize"></div>
            
            <div class="sidebar-header">
                <h1>견적 목록</h1>
                <div class="sidebar-header-actions">
                    <button class="btn-header-action" id="btn-edit-mode" onclick="App.toggleSelectionMode()" title="목록 편집">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                        </svg>
                    </button>
                    <button class="btn-header-action" id="btn-new-quote" title="새 견적">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="12" y1="5" x2="12" y2="19"></line>
                            <line x1="5" y1="12" x2="19" y2="12"></line>
                        </svg>
                    </button>
                    <button class="btn-header-action" id="btn-collapse" title="사이드바 접기">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="15 18 9 12 15 6"></polyline>
                        </svg>
                    </button>
                </div>
            </div>

            <div class="sidebar-toolbar-container">
                <div class="sidebar-section-title">태그와 정렬</div>
                <div class="sidebar-toolbar">
                    <select class="toolbar-select" onchange="App.setSortOrder(this.value)">
                        <option value="newest">최신순</option>
                        <option value="oldest">오래된순</option>
                        <option value="name">이름순</option>
                    </select>
                    <select class="toolbar-select" id="sidebar-tag-filter" onchange="App.setFilterTag(this.value)">
                        <option value="">모든 태그</option>
                    </select>
                </div>
            </div>
            
            <button id="btn-delete-selected" class="btn-danger-block" onclick="App.deleteSelectedQuotes()" style="display:none;">
                선택 항목 삭제
            </button>

            <ul class="quote-list" id="quote-list">
                </ul>

            <div class="sidebar-footer">
                <button class="btn-settings" id="btn-settings">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="3"></circle>
                        <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
                    </svg>
                    <span>설정</span>
                </button>
            </div>
        </aside>

<div class="modal-overlay" id="modal-tag-manager">
        <div class="modal modal-small">
            <div class="modal-header">
                <h2>태그 설정</h2>
                <button class="btn-close" onclick="Modal.close('modal-tag-manager')">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="tag-list-label">태그 선택</div>
                <ul class="tag-manager-list" id="tag-manager-list">
                    </ul>

                <button class="btn-create-tag-toggle" id="btn-show-create-tag" onclick="App.showCreateTagForm()">
                    + 신규 태그 만들기
                </button>

                <div class="new-tag-form-container" id="new-tag-form-container" style="display: none;">
                    <div class="new-tag-form">
                        <input type="color" id="new-tag-color" value="#5b7bf2">
                        <input type="text" id="new-tag-name" placeholder="태그 이름" maxlength="10">
                    </div>
                    <div class="new-tag-actions">
                        <button class="btn-secondary small" onclick="App.hideCreateTagForm()">취소</button>
                        <button class="btn-primary small" onclick="App.saveNewTag()">저장</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

        <main class="main-content">
            <div class="main-header">
                <button class="btn-history" id="btn-undo" title="실행 취소 (Ctrl+Z)" disabled>
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M3 7v6h6"></path>
                        <path d="M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13"></path>
                    </svg>
                </button>
                <button class="btn-history" id="btn-redo" title="다시 실행 (Ctrl+Y)" disabled>
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M21 7v6h-6"></path>
                        <path d="M3 17a9 9 0 0 1 9-9 9 9 0 0 1 6 2.3l3 2.7"></path>
                    </svg>
                </button>
            </div>
            <div class="calculator-container" id="calculator-container"></div>
        </main>
    </div>

    <div class="modal-overlay" id="modal-settings">
        <div class="modal">
            <div class="modal-header">
                <h2>설정</h2>
                <button class="btn-close" data-modal="modal-settings">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="tabs">
                    <button class="tab active" data-tab="materials">재료 단가</button>
                    <button class="tab" data-tab="clients">핵심 고객사</button>
                    <button class="tab" data-tab="options">옵션/후가공</button>
                    <button class="tab" data-tab="data">데이터</button>
                </div>
                
                <div class="tab-content active" id="tab-materials">
                    <div class="setting-section">
                        <div class="setting-header">
                            <span>재료 + 컬러별 단가</span>
                            <button class="btn-pill primary" id="btn-add-material">+ 추가</button>
                        </div>
                        <ul class="item-list" id="material-list"></ul>
                    </div>
                </div>

                <div class="tab-content" id="tab-clients">
                    <div class="setting-section">
                        <div class="setting-header">
                            <span>핵심 고객사 목록</span>
                            <button class="btn-pill primary" id="btn-add-client">+ 추가</button>
                        </div>
                        <ul class="item-list" id="client-list"></ul>
                    </div>
                </div>

                <div class="tab-content" id="tab-options">
                    <div class="setting-section">
                        <div class="setting-header">
                            <span>옵션 및 후가공 프리셋</span>
                            <button class="btn-pill primary" id="btn-add-option-preset">+ 추가</button>
                        </div>
                        <ul class="item-list" id="option-preset-list"></ul>
                    </div>
                </div>

                <div class="tab-content" id="tab-data">
                    <!-- 파일 저장 설정 (File System API) -->
                    <div class="setting-section">
                        <div class="setting-header">
                            <span>로컬 파일 저장</span>
                        </div>
                        <div class="file-storage-section">
                            <p class="data-description">
                                로컬 폴더를 지정하면 모든 데이터가 파일로 자동 저장됩니다.<br>
                                브라우저 캐시를 삭제해도 데이터가 안전하게 보관됩니다.
                            </p>
                            <div class="file-storage-status" id="file-storage-status">
                                <!-- 상태가 여기에 동적으로 표시됨 -->
                            </div>
                            <div class="file-storage-actions">
                                <button class="btn-secondary" id="btn-select-folder" onclick="App.selectStorageFolder()">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right:8px;">
                                        <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>
                                    </svg>
                                    저장 폴더 선택
                                </button>
                                <button class="btn-secondary" id="btn-disable-file-storage" onclick="App.disableFileStorage()" style="display:none;">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right:8px;">
                                        <line x1="18" y1="6" x2="6" y2="18"></line>
                                        <line x1="6" y1="6" x2="18" y2="18"></line>
                                    </svg>
                                    파일 저장 해제
                                </button>
                            </div>
                            <p class="file-storage-note" id="file-storage-note"></p>
                        </div>
                    </div>

                    <!-- 기존 설정 데이터 관리 -->
                    <div class="setting-section">
                        <div class="setting-header">
                            <span>설정 데이터 관리</span>
                        </div>
                        <div class="data-actions">
                            <p class="data-description">
                                현재 등록된 재료, 고객사, 옵션 설정을 파일로 저장하거나 불러올 수 있습니다.<br>
                                (견적 목록은 포함되지 않습니다)
                            </p>
                            <div class="data-buttons">
                                <button class="btn-secondary" id="btn-export-data">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right:8px;">
                                        <path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"></path>
                                        <polyline points="16 6 12 2 8 6"></polyline>
                                        <line x1="12" y1="2" x2="12" y2="15"></line>
                                    </svg>
                                    설정 내보내기 (Export)
                                </button>
                                <button class="btn-secondary" id="btn-import-trigger">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right:8px;">
                                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                        <polyline points="7 10 12 15 17 10"></polyline>
                                        <line x1="12" y1="15" x2="12" y2="3"></line>
                                    </svg>
                                    설정 불러오기 (Import)
                                </button>
                                <input type="file" id="input-import-file" accept=".json" style="display:none;">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="modal-icon-picker">
        <div class="modal modal-small">
            <div class="modal-header">
                <h2>아이콘 선택</h2>
                <button class="btn-close" data-modal="modal-icon-picker">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="icon-grid" id="icon-picker-grid"></div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="modal-material-edit">
        <div class="modal modal-small">
            <div class="modal-header">
                <h2 id="material-modal-title">재료 추가</h2>
                <button class="btn-close" data-modal="modal-material-edit">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <form id="form-material">
                    <input type="hidden" id="material-id">
                    <div class="form-group">
                        <label for="material-name">재료명</label>
                        <input type="text" id="material-name" required placeholder="예: 스탠다드 레진">
                    </div>
                    <div class="form-group">
                        <label for="material-color">컬러</label>
                        <input type="text" id="material-color" required placeholder="예: 그레이">
                    </div>
                    <div class="form-group">
                        <label for="material-price">단가 (원/단위부피)</label>
                        <input type="number" id="material-price" required min="0" placeholder="500">
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn-secondary" data-modal="modal-material-edit">취소</button>
                        <button type="submit" class="btn-primary">저장</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="modal-client-edit">
        <div class="modal modal-small">
            <div class="modal-header">
                <h2 id="client-modal-title">고객사 추가</h2>
                <button class="btn-close" data-modal="modal-client-edit">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <form id="form-client">
                    <input type="hidden" id="client-id">
                    <div class="form-group">
                        <label for="client-name">고객사명</label>
                        <input type="text" id="client-name" required placeholder="예: ABC 컴퍼니">
                    </div>
                    <div class="form-group">
                        <label for="client-discount">할인율 (%)</label>
                        <input type="number" id="client-discount" required min="0" max="100" placeholder="10">
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn-secondary" data-modal="modal-client-edit">취소</button>
                        <button type="submit" class="btn-primary">저장</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="modal-option-preset-edit">
        <div class="modal modal-small">
            <div class="modal-header">
                <h2 id="option-preset-modal-title">옵션 추가</h2>
                <button class="btn-close" data-modal="modal-option-preset-edit">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <form id="form-option-preset">
                    <input type="hidden" id="option-preset-id">
                    <div class="form-group">
                        <label for="option-preset-type">종류</label>
                        <select id="option-preset-type">
                            <option value="postProcessing">후가공</option>
                            <option value="mechanism">옵션/메커니즘</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="option-preset-name">항목명</label>
                        <input type="text" id="option-preset-name" required placeholder="예: 자석 추가, 표면 연마">
                    </div>
                    <div class="form-group">
                        <label for="option-preset-price-type">가격 방식</label>
                        <select id="option-preset-price-type">
                            <option value="fixed">고정 금액 (원)</option>
                            <option value="percent">추가 비율 (%)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="option-preset-price">금액/비율</label>
                        <input type="number" id="option-preset-price" required min="0" placeholder="5000 또는 10">
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn-secondary" data-modal="modal-option-preset-edit">취소</button>
                        <button type="submit" class="btn-primary">저장</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="modal-quote-name">
        <div class="modal modal-small">
            <div class="modal-header">
                <h2>견적 이름</h2>
                <button class="btn-close" data-modal="modal-quote-name">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <form id="form-quote-name">
                    <input type="hidden" id="quote-name-id">
                    <div class="form-group">
                        <label for="quote-name-input">견적명</label>
                        <input type="text" id="quote-name-input" required placeholder="예: 피규어 A 견적">
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn-secondary" data-modal="modal-quote-name">취소</button>
                        <button type="submit" class="btn-primary">저장</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="modal-parts-list">
        <div class="modal modal-large">
            <div class="modal-header">
                <h2>파트 목록</h2>
                <button class="btn-close" onclick="Modal.close('modal-parts-list')">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <div class="modal-body" id="modal-parts-list-body">
                <!-- 파트 목록이 여기에 동적으로 렌더링됨 -->
            </div>
        </div>
    </div>

    <script src="js/data.js"></script>
    <script src="js/modal.js"></script>
    <script src="js/calculator.js"></script>
    <script src="js/app.js"></script>
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then((reg) => console.log('SW registered:', reg.scope))
                    .catch((err) => console.log('SW registration failed:', err));
            });
        }
    </script>
</body>
</html>
